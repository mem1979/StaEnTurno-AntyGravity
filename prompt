Quiero que generes un proyecto Android completo desde cero, llamado STAenTurno, utilizando Jetpack Compose + MVVM + Retrofit + StateFlow + Navigation, con una arquitectura modular, cÃ³digo limpio y siguiendo completamente las reglas y especificaciones funcionales + tÃ©cnicas indicadas a continuaciÃ³n.

Este proyecto debe integrarse al backend real existente, y por lo tanto debes respetar estrictamente todos los endpoints, headers y DTOs especificados.
No inventes, modifiques ni agregues ningÃºn endpoint adicional.

ğŸš€ 1. OBJETIVO DEL PROYECTO

Crear una aplicaciÃ³n Android para fichar asistencia laboral.
El empleado inicia sesiÃ³n, verifica su turno, ve si ya fichÃ³ ENTRADA hoy y registra asistencia enviando ubicaciÃ³n real desde el dispositivo.

ğŸš€ 2. TECNOLOGÃAS OBLIGATORIAS
ANDROID

Kotlin

Jetpack Compose

Navigation Compose

MVVM

StateFlow

Retrofit + OkHttp

GsonConverterFactory

SharedPreferences (PrefsManager)

Coroutines

Material3

FusedLocationProviderClient

ARQUITECTURA

Estructura obligatoria:

com.sta.staenturno
 â”œâ”€â”€ data
 â”‚    â”œâ”€â”€ local
 â”‚    â”œâ”€â”€ model
 â”‚    â”œâ”€â”€ remote
 â”‚
 â”œâ”€â”€ ui
 â”‚    â”œâ”€â”€ login
 â”‚    â”œâ”€â”€ home
 â”‚    â”œâ”€â”€ changePassword
 â”‚    â””â”€â”€ components
 â”‚
 â”œâ”€â”€ util
 â”œâ”€â”€ MainActivity.kt
 â””â”€â”€ STAApplication.kt

ğŸš€ 3. BACKEND â€“ DEFINICIÃ“N OFICIAL (OBLIGATORIA)

Base URL (NO cambiar):

http://10.0.2.2:8080/biometric/api/

âœ” /auth/login

POST â€“ x-www-form-urlencoded + Header X-Device-ID

Params:

usuario

contrasena
Header obligatorio:

X-Device-ID

Response:

{
  "token": "jwt",
  "usuario": "MMosquera@A1",
  "deviceId": "xxxx",
  "passwordDefault": false
}

âœ” /auth/me

GET â€“ requiere Authorization

Response:

{
  "usuario": "MMosquera@A1",
  "turnoActivoHoy": "TM.01 / MIE / 07:00 a 16:00",
  "nombreCompleto": "Mosquera, Marcelo"
}

âœ” /asistencia/hoy

GET â€“ requiere Authorization

Response:

{
  "fecha": "2024-02-01",
  "yaFichoEntrada": true,
  "horaEntrada": "08:03"
}

âœ” /asistencia

POST â€“ JSON + Headers obligatorios

Headers:

Authorization: Bearer XXX

X-Device-ID: <deviceId>

Body:

{
  "descripcionTipo": null,
  "tipoMovimiento": null,
  "ubicacion": "-34.68,-58.36"
}


Response:

{
  "estado": "ok",
  "fecha": "2024-02-01",
  "hora": "08:03",
  "tipo": "ENTRADA",
  "mensaje": "Se registrÃ³ correctamente el INICIO de la jornada.",
  "nombreCompleto": "Mosquera, Marcelo",
  "turnoActivoHoy": "Turno maÃ±ana"
}

âœ” /auth/cambiarClave

POST â€“ Authorization + form param nueva

{
  "success": true
}

ğŸš€ 4. REGLAS DE NEGOCIO (OBLIGATORIAS)
ğŸ”¸ DeviceId

Generado una sola vez por el dispositivo

Obligatorio para /auth/login y /asistencia

Si no coincide â†’ manejar HTTP 401 â€œDispositivo no autorizadoâ€

ğŸ”¸ UbicaciÃ³n

Obligatorio para registrar asistencia

Usar FusedLocationProviderClient

Si no hay permisos â†’ mostrar mensaje y pedirlos

Sin ubicaciÃ³n â†’ NO llamar al backend

ğŸ”¸ Fichadas

El backend deduce tipoMovimiento automÃ¡ticamente.
La app solo envÃ­a ubicacion.

ğŸ”¸ Seguridad

Guardar token en SharedPreferences

Todas las requests deben incluir Authorization

ğŸš€ 5. PANTALLAS A GENERAR
âœ” LOGIN

usuario + contraseÃ±a

obtiene deviceId con DeviceIdProvider

llama POST /auth/login

si passwordDefault = true â†’ navegar a ChangePassword

si login ok â†’ ir a Home

âœ” CAMBIAR CONTRASEÃ‘A

campo nueva contraseÃ±a

mÃ­nimo 8 chars

llama POST /auth/cambiarClave

si OK â†’ ir a Home

âœ” HOME

Debe mostrar:

Empleado: <nombreCompleto>
Turno: <turnoActivoHoy>
Entrada registrada: <horaEntrada> (si existe)
Ãšltimo movimiento: tipo - hora
Mensaje del backend


BotÃ³n grande:

Registrar asistencia


Al presionar:

Verificar permisos ubicaciÃ³n

Obtener lat,long reales

Enviar a POST /asistencia

Mostrar LoadingDialog

Actualizar UI con respuesta

ğŸš€ 6. COMPONENTES UTILITARIOS

Generar:

DeviceIdProvider

Usa ANDROID_ID

Retorna deviceId Ãºnico y persistente

LocationProvider

Usa FusedLocationProviderClient

MÃ©todos:

hasLocationPermission()

getCurrentLocation(): Pair<Double,Double>?

LoadingDialog

Modal simple animado Material3

ğŸš€ 7. ViewModels â€“ Reglas obligatorias
LoginViewModel

login(usuario,contraseÃ±a,deviceId)

guarda token en PrefsManager

expone loading/error/state

HomeViewModel

cargarHome() â†’ llama /auth/me + /asistencia/hoy

registrarAsistencia(deviceId, ubicacion)

manejar todos los errores HTTP e IO

exponer HomeState con todos los campos:

loading
error
nombreCompleto
turnoActivoHoy
yaFichoEntrada
horaEntrada
mensaje
tipo
hora

ğŸš€ 8. NAVEGACIÃ“N

GraÌfico requerido:

Login â†’ ChangePassword â†’ Home


Rutas:

login
change_password
home

ğŸš€ 9. QUE DEBE GENERAR GOOGLE ANTIGRAVITY
âœ” TODO el proyecto Android completo

Incluyendo:

build.gradle raiz

build.gradle mÃ³dulo app

AndroidManifest

Estructura de paquetes

Todos los ViewModel

Todas las pantallas

Todos los DTO

Retrofit + Servicios

Providers de deviceId y ubicaciÃ³n

PrefsManager

Navigation Graph

MainActivity con Compose

DiseÃ±o responsivo Material3

âœ” CÃ³digo final 100% listo para compilar
âœ” NingÃºn TODO
âœ” NingÃºn mÃ©todo sin implementar
âœ” Ninguna dependencia faltante
âœ” Sin inventar endpoints
âœ” Todo debe corresponder EXACTAMENTE al backend ya definido
